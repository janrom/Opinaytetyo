
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
MUISTIINPANOT WEBSTORY ENGINE:
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Tähän osioon tulee sama rakenne kuin osiossa 3.1. Ren’Py.
jotain tekstiä.
Muistiinpanot:

Ei perinteistä if-ehtolausetta käytössä. xml-elementille voi antaa attribuutin ifvar, ifvalue ja ifnot. Näiden avulla voidaan tarkastella onko annetulla muuttujalla haluttua arvoa. 
Esim:
<line s=”n” ifvar=”muuttujanNimi” ifvalue=”haluttuArvo”>
   näytä tekstiä
</line>
Esimerkki tulostaa rivin ”näytä tekstiä” jos muuttujan ”muuttujanNimi” arvo on ”haluttuArvo”.
Tämä on ihan toimiva ratkaisu silloin kun tarkastus tehdään yhdelle elementille mutta työläs usemman elementin tarkastelussa. Tämän ongelman voi todennäköisesti poistaa antamalla if-attribuutit ensimmäiselle elementille josta siirrytään omaan sceneen jos arvo toteutuu. Loput elementit sijaitsevat tässä scenessä jolloin niille ei tarvitse antaa if-attribuuttia.

show ja hide asset on ihan perseestä: show asset ei korvaa sillä hetkellä näkyvissä olevaa assettia ja se piirretään saman z-indeksin omaavan kuvapakan alimmaiseksi. Eli edellinen assetti pitää piilottaa hide-komennolla. Hide vaatii aina assetin nimen. Nimeä on välillä tuskallista selvittää jos assetteja näytellään ja piilotellaan flow-controllin avulla ts. pelaajan päätösten mukaisesti. Ja koska pelaajan päätös laukasee heti napin attributtina olevan goto-käskyn, ei piilotusta voi tehdä lähde scenessa vaan kohde scenessä. Jos kohdesceneen tullaan monesta eri lähteestä pitää tehdä useita piilotuksia joista vain käytetään yhtä sillä hetkellä tai sitten pitää tehdä if-rakenne javascriptillä.

Kuvat piirtyvät selainikkunaan oudosti. Ensin kuvasta piirtyy mustalle taustalle ja sen jälkeen vanhan kuvan päälle (jos kyseessä suurempi kuva).

Ei debuggausta. XML-tiedoston voi validoida mutta jos logiikka kusee niin ei voi kuin etsiä ongelma koodin seasta

Valintapainikkeet ovat kiinteän mittaisia. Pitkät teksti eivät näy. Jos napeista tekee pitkän tekstin pituisia niin lyhyet tekstit näyttävät hölmöiltä. Ts. automaagisesti skaalautuvat napit ois hyvä (niin kuin Ren’pyssä on).

Mitä tästä opimme: KÄYTÄ VAIN HYVIN DOKUMENTOITUJA TYÖKALUJA / YMPÄRISTÖJÄ JOILLA ON LAAJA KÄYTTÄJÄKUNTA = PALJON FORUM POSTAUKSIA ONGELMA- JA KÄYTTÖTILANTEISTA.

Teksti ei rivity valintanapissa vaan leveyden ylimenevä osa leikataan pois. Yritin lisätä rivityksen valintanapin lähekoodin Stackoverflow:sta löytämäni vastauksen perusteella: http://stackoverflow.com/questions/13048499/text-in-newline-in-html-input-type-button
lisäsin WebStoryEngine.js tiedoston rivin 8486 jälkeen seuraavat rivit:
currentButton.setAttribute("value", "Carriage&#13;&#10;return&#13;&#10;separators");
currentButton.setAttribute("style", "text-align:center;");
mutta niillä ei ollut mitään vaikutusta napin tekniseen tai visuaaliseen käytökseen.

Käänsin audiotiedostot selainten vaatimiin mp3 ja ogg tyyppeihin medio.io verkkosivuston työkalulla: http://media.io/

Sain border-kuvat aseteltua ruudun reunoihin käyttämällä moottorin omaa, kuville tarkoitettua imagepack-elementtiä, sillä on attribuutit x- ja y-koordinaateille.
Kuvat näytetään kuten muutkin kuvat ”set asset” ja ”show asset” komennoilla. Skriptin tekeminen ei onnistu. Tarkoitus on käyttää Javascriptin onmouseover eventtiä jokaiselle border-kuvaelementille. Eventin tapahtuessa tarkistetaan kulunut aika ja palautetaan true jos event tapahtui määritellyn aikarajan sisällä tai false jos aikaraja ylittyi. Tämä tehdään loopin sisällä jossa arvotaan kolme näytettävää borderia neljästä eli yksi kuvaruudun reuna ei saa kuvaa, hiiri on tarkoitus siirtää kuvattomalle alueelle (jossa on siis kuvaelementti jonka visibility css-arvo on hidden). True arvo vie loopin seuraavalle kierrokselle jos kierroksia on vielä jäljellä. Jos kierrokset ovat täynnä mennään loopistä ulos ja palautetaan onnistuneen scenen nimi johon game flow siirtyy (annetaan parametrina javascript funtiolle). False arvolla palautetaan epäonnistuneen skenen nimi (annetaan myös parametrina).
Tämän funktion toteutus ei siis onnistu koska en saa minkäänlaista Javascript- funktiota toimimaan en edes yksinkertaista onmouseover-esimerkkiä w3school sivustolta: http://www.w3schools.com/jsref/tryit.asp?filename=tryjsref_onmouseover_dom
Tämä voi johtua siitä ettei imagepack-elementillä ole onmouseover-eventtiä. Imagepack-elementti on Javascriptillä määritelty XML-elementti. Sillä ei ole varsinaista XML-schemaa vaan määrittely on tehty puhtaasti Javascriptillä. onmouseover-event on taas HTML-elementille määritelty event. Käsittääkseni XML-elementeille ei ole mitään ”default määrittelyjä” kuten HTML-elementeillä, vaan kaikki määrittelyt löytyvät XML-schemasta. Toisin sanoen jos määrittelyä ei löydy schemasta ei elementillä sitä ole. Mutta koska imagepack-elementillä ei schemaa ole, en tiedä miten määrittely pitäisi tehdä. Ainoa vaihtoehto voi olla kyseinen Javascript-tiedosto (WebStoryEngine.js) jossa on imagepack-elementin määrittely ja XML-porttaus (XML-porttaus on tehty JavaScripitin module patternilla), mutta jälleen kerran en tiedä kuinka edes aloittaa. Käsittääkseni Javascriptillä ei ole muita eventtejä kuin kyseiset HTML-eventit.
Eli yhteenvetona tuntuu ettei Javascript-eventtiä saa toimimaan XML-elementissä ilman schemaa (jota ei ole). Eli eventtiä ei saa käyttöön kuin ehkä jollain Javascript-virityksellä mistä minulla ei ole mitään käsitystä. Hiiren ja kuvaelementin tarkkailu on välttämätöntä skriptin toteutuksessa (onko hiiri kuvaelementin päällä). En keksi muuta tapaa (ilman kohtuuttomia virityksiä) tämän toteutukseen kuin eventit ja se ei toimi kuten edellä mainitsin, joten jätän skriptin tekemättä.
Huomiona vielä, että yritin suorittaa skriptiä moottorin line-elementin tagien sisällä, perustuen seuraavaan moottorin kehittäjän forum vastaukseen: https://iiyo.org/f/discussion/55/html-asset Kehittäjä sanoo, että line-elementille voi antaa Javascript-koodia, esimerkki:

// imagepack esittely
<imagepack name="borderTop" x="0px" y="0px">
<image  name="imgBorderTop" src="assets/images/borders/top2.png" />
</imagepack>

// textbox esittely
<textbox cssid="tbChase" name="tb_chase" width="780px" height="100px" x="10px" y="490px" namebox="no" speed="0">
	<nameTemplate>{name}</nameTemplate>
</textbox>

// character esittely
<character name="c" textbox="tb_chase">
	<displayName></displayName>
</character>

// line jossa käytetään määriteltyä characteriä joka käyttää määriteltyä textboxia  (määritelty näkymättöksi default.css)
// tarkoitus siirtää kuvaa onmouseover-eventillä antamalla arvo imagepackin x-attribuutille (kokeilin myös muita kuten em. w3school esimerkkiä)
<line s="c">
<script>
document.getElementById("borderTop").onmouseover = function() { moveImage() };

		function moveImage() 
		{
document.getElementById("borderTop").x = "100px";
		}
	</script>
</line>


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
MUISTIINPANOT VISUAL NOVEL TOOLKIT
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

Tähän osioon tulee perustelut miksi hylkäsin tämän työkalun ja vaihdoin Noveltyyn.

Muistiinpanot:

Kehittäjät eivät ole vastanneet forumviesteihin vuoden 2014 maaliskuun 18.päivän jälkeen (http://forum.unity3d.com/threads/visual-novel-toolkit.217122 ) 

Teksti ei rivity automaattisesti text boxin sisään vaan piirtyy sen yli.
Rivin vaihto on määritelty ylimenevälle osalle scriptitiedostossa VinoTextBox.cs rivillä 105. Se ei kuitenkaan toimi jostain syystä. Yksi syy voi olla, pituus luetaan counter-muuttujaan jota tarkastellaan wrapEvery-muuttujaan. Oletettavasti wrapEvery on rivin maksimipituus. Tämä saattaa olla pidempi mitä varsinainen tekstialueen visuaalinen kuva on. Eli mitta ei ylity vaikka se meneekin kuvan yli. Maksimimittaa ei voi tarkastella koska se sisältyy VinoToolkit-kirjastoon enkä löydä kyseistä kirjastoa mistään. Oletettavasti siitä ei ole lähdekoodia saatavilla.
Tämä johtaa siihen, että rivinvaihto on tehtävä käsin. Tämä taas johtaa ongelmiin eri resoluutioilla.
Visual Novel Toolkit (vino) lisää oman valikon Unityn GameObject-valikkoon. Valikosta saa lisäyttyä TextBoxin ja sitä tarkastellessa Inspectorissa siellä voi antaa arvon wrapEvery muuttajalle samoin löytyy Wrap Text boolean, johon laittaessa rastin teksti alkaa rivittymään wrapEvey muuttujaan määritellyllä rivin pituudella.

User manual (pdf) on vanhentunut. Sellaisia valikoita joita kuvakaappauksissa näytetään ei enää ole. Esim. ViNo-valikon pitäisi olla Window-valikon vieressä päävalikkona. Ellei se ole vain maksulisessa versiossa?

Yritin liittää kahta sceneä yhteen user manualin ohjeiden mukaisesti. Loin ensin scene1den, lisäsin siihen dialogin. Teksti näkyi oikein kun testasin. Lisäsin dialogiin LoadScene-objektin. Loin toisen scenen ViNoToolbarin scenario-välilehdellä. Lisäsin myös sille dialogin ja raahasin scenen resources-kohtaan. Tuhosin luodon scene hierarkia-ikkunasta. Lisäsin scene2:den scene1:den LoadScene-komponenttiin. Ohjeen mukaan nyt kahden scenen pitäisi olla linkitetty mutta kun painoin playta ei näkynyt kuin musta ruutu. Poistin elementtejä takaperin edellä mainitusta järjestyksestä ja testasin skeneä joka askeleen jälkeen mutta ruutu pysyi mustana. Toistin koko homman muutamasti mutta aina sama laulu. Teksti lakkaa näkymästä kun lisään toisen skenen. Ei auta vaikkaa poista ruksin kohdasta ”Play at start” tai jos poistan kaikki lapsiobjektit.
Ongelmaan ei löydy apua netistä.
Suosittelen Unity-lisäriksi mieluummin LDC (localiced dialogs & cutscenes) pakettia. Sillä onnistuu mm. visuaalisten novellien teko: http://forum.unity3d.com/threads/ldc-localized-dialogs-cutscenes-powerful-and-intuitive-dialog-system-with-tons-of-features.157128/

Lopetan tämän kanssa pelleilyn koska tuote on selkeästi susi. Eikä kehittäjätkään tunnu enää kehittävän sitä, ainakaan eivät ole enää vastailleet foorumille.
Vaihdan Noveltyyn koska sillä onnistuu myös visuaalisen novellin kehittäminen puhtaasti graafisesti (ilman koodausta). Siinä on myös tuki skriptikielellä (AngelScrit) joten lisäpalikan teko myös siihen onnistuu.
Mielenkiintoinen vaihtoehto on Belle. Se on täysin graafinen työkalu eikä siinä käsittääkseni ole skriptaustukea. Se tukee myös linuxia ja maciä toisin kuin Novelty. Kehittäjän viimeisin versiojulkaisu on 2014 syyskuulta toisin kuin Noveltyn vuodelta 2010. Toisaalta Bellellä ei ole forumia ja tuki on vielä olematonta toisin kuin Noveltyllä on omalla forumilla jo tuhansia viestejä.

 
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
MUISTIINPANOT NOVELTY
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


Muistiinpanot:

Fontti pitää olla bitmap-muodossa (.fnt). Valmiit fontit ovat suuria joten yritin importata uuden pienemmän. Aina tuli virheilmoitus ”Unable to load font”. Forumilla oli viestejä samasta virheestä mutta ketkä yrittivät auttaa eivät onnistuneet saamaan virhettä aikaan eli heillä se toimi moitteetta. Huomasin kokeilujen jälkeen, että virhe johtuu liian pitkästä tiedostopolusta. Nyt ei tule virhettä mutta fontti ei silti ilmesty asset-hakemistoon, johon sen pitäisi ilmestyä. Tiedostot ilmestyvät kuitenkin kohdekansioon eli ongelma on saada näkyviin ne työkalun asset-näkymään.
Kerran fonttien importtaus onnistui, tein kaiken niin kuin aiemmin mutta fontti ilmestyä asset kirjastoon. Vähän ajan päästä Novelty kaatui. Tein uuden fontin Noveltyn mukana tulevalla fonttieditorilla mutta sen importtaus ei onnitunut vaan tulee sama virheilmoitus. Kun tein uuden fontin Littera nettityökalulla importtaus onnistuu, tosin tulee nimeämisvirhe.

kuvien feidaus tosi helppo tehdä action windowissa, oikeastaan tarvitsee vain valita feidaako sisään vai ulos, muut arvot ovat yleensä hyvät jo oletuksena.

tekstilaatikon ja kuvan sijainnin ja koon saa asetettua helposti property inspectorissa.

hahmoon liittyvä dialogi pitää esittää hahmon kautta. Hahmo on kuva jolle määritellään nimi ja häneen liittyvän dialogin väri. Ts. ilman kuvaa ei myöskään dialogia voi värittää. Tämä on ongelma kun ei käytetä hahmojen kuvia.

äänien importtaus ja lisäys sceneen todella helppoa ja nopeaa.

valintamenut ovat kiinteitä grafiikoita eli eivät skaalaudu sisällön mukaan.
uuden graafisen assetin teko on helppoa Desingerillä. Esim. uuden menun tekeminen muokkaamalla vanhaa, muuttaen sen kokoa vie vain hetken.

Ympäristön tuki skriptaukselle on aika heikko. Tekstieditori on pelkkä notepad tyylinen, ei värikoodausta tai mitään. Rivinvaihto vie aina rivin alkuun mikä on ärsyttävää. Skriptille ei ole minkäänlaista virheidentarkastusta eli ympäristö ei ilmoita jos koodissa on virheitä vaan kaikki selvitystyö jää käyttäjän harteille.

Ei ole omaa forumia. Kehittäjän sähköpostiosoite on sivuilla josta apua voi kysyä tai Lemmesoft forumilta mutta siellä on vain yksi Visual Novelty thread. Työkalun käyttäjiä kuitenkin forumilla on.

Kääntäjä puuttuu. Kun ohjelman suorittaa, Novelty vain ilmoittaa, että jossakin kooditiedostossa on virhe ja se jätetään suorittamatta. Jos kooditiedostoja on useita, virheellinen kooditiedosto löytyy vain kokeilemalla. Sama pätee virheen etsimiseen itse tiedostosta.

Projektista ei saa poistettua sinne importattuja skriptitiedostoja. Kun tiedoston importtaa Asset librarystä tulee ilmoitus, että kyseinen asset on lisätty projektiin mutta se ei tulle minnekään näkyviin. Noveltyssä on scene-lista jossa näkyy kaikki skenessä olevet assetit mutta jostain syystä skriptiassetit eivät ilmesty siihen. Tämä on ongelma jos importatussa skriptissä on virhe, silloin tulee aina virheilmoitus ohjelmaa suoritettaessa ja tämä vaikeuttaa virheiden jäljitystä entisestään uusien skriptien kohdalla. Ratkaisu ongelmaan tuntuu olevan uuden projektin luonti ja kaikkien elementtien kopiointi siihen, yksi kerrallaan.

Noveltyssä ei tunnu olevan funktiota ajan mittaamiseen. AngelScript käyttää Windowsin (http://msdn.microsoft.com/en-us/library/windows/desktop/dd757629%28v=vs.85%29.aspx) oman kirjaston timeGetTime-funktiota mutta koska Novelty on suljetun lähdekoodin ohjelmisto en voi tarkistaa onko timeGeTime:n tarvitsemat kirjastot käytössä. Funktio ei ainakaan toimi suoraan, eikä headereiden (  Windows.h Mmsystem.h ) includauskaan auta.

Toteutin aikatoiminnon Noveltyn Wait-actionilla. Jokaisella border kuvaelementillä on OnMouseEnter event script joka laittaa lipun päälle jos hiiri tulee kuvaelementin alueelle. Tein branching virityksen Noveltyn Branch-actionilla. Event lipun true arvo vie success skeneen ja false vie false skeneen. 
Tein aluksi lipun kytkemisen true arvoon siten että jokaisella border kuvaelementillä on oma lippunsa joka kytketään päälle jos kyseinen kuvaelementti on hiiren kohde-elementti eli hiiri on vietävä kyseisen elementin päälle. Eli jos vasen border kuvaelementti on kohde-elementti, sen lippu kytkeytyy päälle ja kun hiiri viedään elementin alueelle event script ajetaan. Skriptissä katsotaan onko elementtin lippu päällä jos on niin event lippu kytketään päälle. Näin teoriassa jos vasen elementti on kohde-elementti, event lippu ei mene päälle jos hiiri viedään oikean elementin päälle. kaikki kohde elementtien liput asetaan false tilaan heti skriptin alussa joka. Kohde elementin lippu asetaan true tilaan kun näytettävät border kuvaelementit ovat arvottu, näin varmistetaan, että vain yksi kohde-lippu on päällä kerrallaan.
Kuitenkin kun testasin toteutusta niin event lippu meni päälle vaikka hiiri oli ei-kohde-elementin päällä. Koska Noveltyssä ei ole debuggeriä en voi varmaksi todeta, että vain halutun elementin kohdelippu on päällä ja meneekö event lippu päälle väärästä paikakasta vai onko kyse jostain muusta.
Mutta skripti suoretaan uudelleen vain jos event lipun arvo on true ja näyttökertoja on vähemmän kuin annettu arvo, tämä on määritelty em. branch-actionin ehtoina.
Muutin toteutusta niin, että tein oman skriptitiedoston jokaiselle kuvaelementille. Skriptissä kytketään vain event-lippu päälle OnMouseEnter-eventillä. Tämä muutoksen takia jouduin tekemään oman branch-actionin jokaiselle eventille. Nyt true arvo vie success skeneen ja false arvo siirtyy seuraavaan branch-actioniin. Jokainen branch siis tarkistaa onko tietyn eventin lippu true.
Kun testasin toteutusta niin lopputulos oli sama kuin edellisellä. Tämä kielisi, että ongelma on jossain muualla. Mutta ilman debuggausta ongelmaa on todella vaikeaa jäljittää. Annan asian olla tässä vaiheessa.

Bugi Noveltyssä: branching ja goto arvot menivät sekaisin ilman syytä joissakin skeneissä. Eli branch vei väärään skeneen true tai false arvolla.
Action-windowisa lukee silloin eri arvo mikä property inspectorissa on. Inspectrin arvoa käytetään.


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
MUISTIINPANOT NOVELTY
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


Tämä opinnäytetyö tutkii, mitä erilaisia kehitysympäristöjä on tarjolla visuaalisten novellien kehittämiseen. Visuaaliset novellit ovat digitaalisessa muodossa olevia kuvitettuja novelleja, joissa on usein myös ääntä. Yleensä käyttäjä voi vaikuttaa novellin juonen kulkuun tekemällä valintoja dialogissa. Visuaalisten novellien kehitykseen erikoistuneet kehitysympäristöt tarjoavat työkalut dialogin, kuvan ja äänen yhdistämiseen sekä juonen rakentamiseen. Kuva ja ääni kehitetään yleensä jollain ulkopuolisella työkalulla, dialogi ja juonirakenne kehitysympäristöllä. Jotkin kehitysympäristöt tukevat myös videoita ja animaatioita.

opinnäytetyössä esitellään myös pelkkiä moottoreita, joissa ei ole varsinaista kehitysympäristöä. Näissä tapauksissa novelli rakennetaan moottorin omalla skriptauskielellä käyttämällä tekstieditoria. Idea on kuitenkin sama eli yhdistetään eri elementit yhdeksi julkaisuksi.

Käytän tekstissäni yhteisiä termejä tietyille asioille. Näitä termejä ovat työkalut ja julkaisu. Termiä työkalut käytän tekstissä, kun viittaan yleisesti kehitysympäristöihin ja moottoreihin. Termiä julkaisu käytän, kun viittaan työkalulla tehtyyn julkaisuun.

Visuaaliset novellit ovat erityisen suosittuja Japanissa. Siellä ne jaotellaan kerronnallisiin ja toiminnallisiin novelleihin. Kerronnallisissa novelleissa pääpaino on tarinalla ja tekstiä näytetään yleensä useita rivejä kerrallaan. Varsinaista vuorovaikutusta novellin ja lukijan välillä on vähän. Toiminnallisissa novelleissa pääpaino on vuorovaikutuksessa ja tekstiä näytetään yleensä yksi rivi kerrallaan. Toiminnalliset novellit ovat yleensä seikkailupelejä, jotka voivat sisältää roolipelielementtejä. Japanissa vuonna 2006 julkaistuista PC-peleistä melkein 70 prosenttia oli toiminnallisia novelleja (Wikipedia 2014a).

Tämän tutkimuksen tarkoituksena on luoda yhtenäinen ja kattava raportti kaikista tällä hetkellä julkaistuista työkaluista, joissa on tuki Englannin kielelle. Raportin pohjalta voidaan siten valita sopivin kehitysympäristö omaan käyttötarkoitukseen. Tässä tutkimuksessa ei käsitellä keskeneräisiä työkaluja.
